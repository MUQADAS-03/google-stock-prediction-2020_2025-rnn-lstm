# -*- coding: utf-8 -*-
"""gradio_app.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1lH3iJtXcUwP5ODRcChT3fbt9QW8LnShF
"""

!pip install -q tensorflow gradio flask
!pip install -q streamlit pyngrok

from google.colab import files
uploaded = files.upload()

from google.colab import files
uploaded = files.upload()

from google.colab import files
uploaded = files.upload()

from google.colab import files
uploaded = files.upload()

from google.colab import files
uploaded = files.upload()

!pwd
!ls -la

# Commented out IPython magic to ensure Python compatibility.
# %%writefile predict_utils.py
# import numpy as np
# import pickle
# from tensorflow.keras.models import load_model
# 
# # Load the saved scaler
# with open('scaler.pkl', 'rb') as f:
#     scaler = pickle.load(f)
# 
# def load_selected_model(model_name):
#     if model_name == "LSTM":
#         return load_model("lstm_model.h5")
#     elif model_name == "RNN":
#         return load_model("rnn_model.h5")
#     elif model_name == "GRU":
#         return load_model("gru_model.h5")
#     else:
#         raise ValueError("Invalid model name")
# 
# def predict_next(model_name, last_60_values):
#     model = load_selected_model(model_name)
# 
#     seq = scaler.transform(np.array(last_60_values).reshape(-1,1))
#     seq = np.reshape(seq, (1, 60, 1))
# 
#     pred = model.predict(seq)
#     pred_price = scaler.inverse_transform(pred)[0][0]
# 
#     return float(round(pred_price, 2))
#

!mkdir -p templates

# Commented out IPython magic to ensure Python compatibility.
# %%writefile templates/index.html
# <!DOCTYPE html>
# <html>
# <head>
#     <title>Google Stock Predictor</title>
# </head>
# <body>
#     <h1>Google Stock Price Prediction</h1>
# 
#     <form method="POST">
#         <label>Select Model:</label>
#         <select name="model">
#             <option value="LSTM">LSTM</option>
#             <option value="RNN">RNN</option>
#             <option value="GRU">GRU</option>
#         </select>
#         <br><br>
# 
#         <button type="submit">Predict</button>
#     </form>
# 
#     {% if prediction %}
#         <h2>Next Day Predicted Price: ${{ prediction }}</h2>
#     {% endif %}
# </body>
# </html>
#

!ls -la
!ls -la templates

# Commented out IPython magic to ensure Python compatibility.
# %%writefile app_gradio.py
# import gradio as gr
# import pandas as pd
# import numpy as np
# import plotly.graph_objects as go
# from predict_utils import predict_next
# 
# # Load Data
# df = pd.read_csv("google_stock_cleaned.csv")
# close_prices = df["Close"].values
# dates = df["Date"]
# 
# # Function for prediction
# def predict_ui(model_type):
#     last_60 = close_prices[-60:]
#     prediction = predict_next(model_type, last_60)
# 
#     # Last 60 days chart
#     fig = go.Figure()
#     fig.add_trace(go.Scatter(
#         x=dates[-60:], y=last_60,
#         mode="lines+markers",
#         name="Last 60 Days Close Price"
#     ))
#     fig.add_trace(go.Scatter(
#         x=[dates.iloc[-1], dates.iloc[-1]],
#         y=[last_60[-1], prediction],
#         mode="lines+markers",
#         name="Prediction",
#         line=dict(dash="dash")
#     ))
# 
#     fig.update_layout(
#         title="üìà Last 60 Days Closing Prices + Prediction",
#         xaxis_title="Date",
#         yaxis_title="Price (USD)",
#         template="plotly_dark"
#     )
# 
#     # Stock Info Cards
#     latest_open = df["Open"].iloc[-1]
#     latest_close = df["Close"].iloc[-1]
#     latest_high = df["High"].iloc[-1]
#     latest_low = df["Low"].iloc[-1]
# 
#     info = f"""
# ### üìä Latest Market Overview
# | Metric | Value |
# |--------|--------|
# | üîµ Open Price | **${latest_open:.2f}** |
# | üî¥ Close Price | **${latest_close:.2f}** |
# | üü¢ High Price | **${latest_high:.2f}** |
# | üü† Low Price | **${latest_low:.2f}** |
# | ‚≠ê Predicted Next Close Price | **${prediction:.2f}** |
# """
# 
#     return info, fig
# 
# 
# # Interface Layout
# with gr.Blocks(theme=gr.themes.Soft()) as demo:
#     gr.Markdown("<h1 style='text-align:center;'>üìà GOOGLE STOCK FORECASTING APP</h1>")
#     gr.Markdown("### Powered by LSTM ‚Ä¢ RNN ‚Ä¢ GRU Deep Learning Models")
# 
#     with gr.Row():
#         model_dropdown = gr.Dropdown(["LSTM", "RNN", "GRU"], label="Select Prediction Model")
#         predict_btn = gr.Button("Predict Price üîÆ", variant="primary")
# 
#     output_text = gr.Markdown()
#     output_plot = gr.Plot()
# 
#     predict_btn.click(
#         predict_ui,
#         inputs=model_dropdown,
#         outputs=[output_text, output_plot]
#     )
# 
# demo.launch(share=True)
#

!python app_gradio.py