# -*- coding: utf-8 -*-
"""app_flask.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1fqpsbIX-4pH_vvadHOpfeZ_xkJffyNGx
"""

!pip install -q tensorflow gradio flask
!pip install -q streamlit pyngrok

from google.colab import files
uploaded = files.upload()

from google.colab import files
uploaded = files.upload()

from google.colab import files
uploaded = files.upload()

from google.colab import files
uploaded = files.upload()

from google.colab import files
uploaded = files.upload()

!pwd
!ls -la

# Commented out IPython magic to ensure Python compatibility.
# %%writefile predict_utils.py
# import numpy as np
# import pickle
# from tensorflow.keras.models import load_model
# 
# # Load the saved scaler
# with open('scaler.pkl', 'rb') as f:
#     scaler = pickle.load(f)
# 
# def load_selected_model(model_name):
#     if model_name == "LSTM":
#         return load_model("lstm_model.h5")
#     elif model_name == "RNN":
#         return load_model("rnn_model.h5")
#     elif model_name == "GRU":
#         return load_model("gru_model.h5")
#     else:
#         raise ValueError("Invalid model name")
# 
# def predict_next(model_name, last_60_values):
#     model = load_selected_model(model_name)
# 
#     seq = scaler.transform(np.array(last_60_values).reshape(-1,1))
#     seq = np.reshape(seq, (1, 60, 1))
# 
#     pred = model.predict(seq)
#     pred_price = scaler.inverse_transform(pred)[0][0]
# 
#     return float(round(pred_price, 2))
#

!mkdir -p templates

# Commented out IPython magic to ensure Python compatibility.
# %%writefile templates/index.html
# <!DOCTYPE html>
# <html>
# <head>
#     <title>Google Stock Predictor</title>
# </head>
# <body>
#     <h1>Google Stock Price Prediction</h1>
# 
#     <form method="POST">
#         <label>Select Model:</label>
#         <select name="model">
#             <option value="LSTM">LSTM</option>
#             <option value="RNN">RNN</option>
#             <option value="GRU">GRU</option>
#         </select>
#         <br><br>
# 
#         <button type="submit">Predict</button>
#     </form>
# 
#     {% if prediction %}
#         <h2>Next Day Predicted Price: ${{ prediction }}</h2>
#     {% endif %}
# </body>
# </html>
#

!pip install flask-ngrok

!pip install flask-ngrok plotly flask

# Commented out IPython magic to ensure Python compatibility.
# %%writefile templates/index.html
# <!DOCTYPE html>
# <html lang="en">
# <head>
#     <meta charset="UTF-8">
#     <meta name="viewport" content="width=device-width, initial-scale=1.0">
#     <title>Stock Predictor Dashboard</title>
# 
#     <!-- Google Font -->
#     <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
# 
#     <!-- Plotly -->
#     <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
# 
#     <style>
#         body {
#             margin: 0;
#             font-family: "Poppins", sans-serif;
#             background: linear-gradient(140deg, #0f0c29, #302b63, #24243e);
#             min-height: 100vh;
#             color: white;
#         }
# 
#         .container {
#             width: 95%;
#             margin: auto;
#             padding-top: 30px;
#         }
# 
#         .header {
#             text-align: center;
#             padding: 30px 0;
#             margin-bottom: 20px;
#         }
# 
#         .header h1 {
#             font-size: 48px;
#             font-weight: 800;
#             background: linear-gradient(45deg, #00c6ff, #0072ff);
#             -webkit-background-clip: text;
#             -webkit-text-fill-color: transparent;
#             letter-spacing: 1px;
#         }
# 
#         .glass-box {
#             background: rgba(255, 255, 255, 0.08);
#             backdrop-filter: blur(14px);
#             padding: 25px;
#             border-radius: 20px;
#             box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
#             border: 1px solid rgba(255,255,255,0.1);
#         }
# 
#         .glow-btn {
#             background: linear-gradient(45deg, #00c6ff, #0072ff);
#             padding: 12px 20px;
#             border: none;
#             color: white;
#             font-size: 18px;
#             width: 100%;
#             border-radius: 12px;
#             cursor: pointer;
#             font-weight: 600;
#             transition: 0.2s;
#             box-shadow: 0 0 12px rgba(0, 114, 255, 0.7);
#         }
# 
#         .glow-btn:hover {
#             transform: scale(1.03);
#             box-shadow: 0 0 18px rgba(0, 114, 255, 1);
#         }
# 
#         .grid {
#             display: grid;
#             grid-template-columns: 30% 70%;
#             gap: 25px;
#         }
# 
#         #chart-box {
#             height: 520px;
#             border-radius: 20px;
#             overflow: hidden;
#         }
# 
#         .prediction-number {
#             text-align: center;
#             font-size: 42px;
#             margin-top: 10px;
#             font-weight: 700;
#             color: #00eaff;
#             text-shadow: 0 0 15px #00eaff;
#         }
# 
#         .footer {
#             text-align: center;
#             margin-top: 40px;
#             padding: 20px;
#             font-size: 14px;
#             opacity: 0.7;
#         }
# 
#     </style>
# </head>
# 
# <body>
# 
# <div class="header">
#     <h1>üìà Google Stock Forecast Dashboard</h1>
# </div>
# 
# <div class="container">
# 
#     <div class="grid">
# 
#         <!-- LEFT PANEL (CONTROL BOX) -->
#         <div class="glass-box">
#             <h2 style="text-align:center; margin-bottom:20px;">‚öô Select Model</h2>
# 
#             <form method="POST">
#                 <select name="model" style="width:100%; padding:12px; border-radius:12px; font-size:16px;">
#                     <option value="LSTM">LSTM</option>
#                     <option value="RNN">RNN</option>
#                     <option value="GRU">GRU</option>
#                 </select>
# 
#                 <br><br>
#                 <button class="glow-btn" type="submit">Predict üîÆ</button>
#             </form>
# 
#             {% if prediction %}
#             <div style="margin-top:40px;">
#                 <h3 style="text-align:center;">üîÆ Predicted Price</h3>
#                 <div class="prediction-number">${{ prediction }}</div>
#             </div>
#             {% endif %}
#         </div>
# 
#         <!-- RIGHT PANEL (CHART) -->
#         <div class="glass-box" id="chart-box">
#             {% if graphJSON %}
#                 <div id="chart">{{ graphJSON | safe }}</div>
#             {% else %}
#                 <p style="text-align:center; margin-top:200px; opacity:0.5; font-size:18px;">
#                     ‚Üê Choose a model and click Predict
#                 </p>
#             {% endif %}
#         </div>
# 
#     </div>
# </div>
# 
# <div class="footer">
#     Designed with ‚ù§Ô∏è | Deep Learning Stock Predictor
# </div>
# 
# {% if graphJSON %}
# <script>
#     let graph = {{ graphJSON | safe }};
#     Plotly.newPlot('chart', graph.data, graph.layout);
# </script>
# {% endif %}
# 
# </body>
# </html>
#



# Commented out IPython magic to ensure Python compatibility.
# %%writefile app_flask.py
# from flask import Flask, request, render_template
# from flask_ngrok import run_with_ngrok
# import pandas as pd
# import numpy as np
# import plotly.graph_objects as go
# import plotly
# import json
# from predict_utils import predict_next
# 
# app = Flask(__name__)
# run_with_ngrok(app)  # activate ngrok tunnel
# 
# # Load dataset
# df = pd.read_csv("google_stock_cleaned.csv")
# df["Date"] = pd.to_datetime(df["Date"])
# close_prices = df["Close"].values
# 
# @app.route("/", methods=["GET", "POST"])
# def home():
#     prediction = None
#     graphJSON = None
# 
#     if request.method == "POST":
#         model_type = request.form["model"]
# 
#         last_60 = close_prices[-60:]
#         prediction = predict_next(model_type, last_60)
# 
#         # Create plot
#         fig = go.Figure()
#         fig.add_trace(go.Scatter(
#             x=df["Date"].iloc[-60:], y=last_60,
#             mode="lines+markers", name="Last 60 Days"
#         ))
#         fig.add_trace(go.Scatter(
#             x=[df["Date"].iloc[-1], df["Date"].iloc[-1] + pd.Timedelta(days=1)],
#             y=[last_60[-1], prediction],
#             mode="lines+markers", name="Prediction",
#             line=dict(dash="dash")
#         ))
#         fig.update_layout(template="plotly_dark", height=400)
# 
#         graphJSON = json.dumps(fig, cls=plotly.utils.PlotlyJSONEncoder)
# 
#     return render_template("index.html", prediction=prediction, graphJSON=graphJSON)
# 
# if __name__ == "__main__":
#     app.run()
#

!pip install pyngrok

from pyngrok import ngrok
ngrok.set_auth_token("36kmJ0bvtMRe9zUugdkn8crDcZs_7exgRJYj67DRvYUxXkTPn")

# Commented out IPython magic to ensure Python compatibility.
# %%writefile app_flask.py
# from flask import Flask, request, render_template
# import pandas as pd
# import numpy as np
# import plotly.graph_objects as go
# import plotly
# import json
# from predict_utils import predict_next
# 
# app = Flask(__name__)
# 
# df = pd.read_csv("google_stock_cleaned.csv")
# df["Date"] = pd.to_datetime(df["Date"])
# close_prices = df["Close"].values
# 
# @app.route("/", methods=["GET", "POST"])
# def home():
#     prediction = None
#     graphJSON = None
# 
#     if request.method == "POST":
#         model_type = request.form["model"]
# 
#         last_60 = close_prices[-60:]
#         prediction = predict_next(model_type, last_60)
# 
#         fig = go.Figure()
#         fig.add_trace(go.Scatter(
#             x=df["Date"].iloc[-60:], y=last_60,
#             mode="lines+markers", name="Last 60 Days"
#         ))
#         fig.add_trace(go.Scatter(
#             x=[df["Date"].iloc[-1], df["Date"].iloc[-1] + pd.Timedelta(days=1)],
#             y=[last_60[-1], prediction],
#             mode="lines+markers", name="Prediction",
#             line=dict(dash="dash")
#         ))
#         fig.update_layout(template="plotly_dark", height=400)
# 
#         graphJSON = json.dumps(fig, cls=plotly.utils.PlotlyJSONEncoder)
# 
#     return render_template("index.html", prediction=prediction, graphJSON=graphJSON)
# 
# if __name__ == "__main__":
#     app.run()
#

public_url = ngrok.connect(5000)
print(public_url)

!python app_flask.py